# external_components:
#   - source:
#       type: local
#       path: waveshare-example

packages:
  ha_entities: !include ha_entity_config.yaml

esphome:
  name_add_mac_suffix: false
  on_boot:
    priority: 600  # After hardware initialization (priority 600 runs early)
    then:
      - light.turn_on:
          id: backlight_light
          brightness: 10%

esp32:
  board: esp32-p4-evboard
  flash_size: 32MB
  framework:
    components:
      - espressif/esp_hosted==2.11.3
    type: esp-idf
    version: recommended
    advanced:
      enable_idf_experimental_features: true
  cpu_frequency: 360MHz

logger:
  level: DEBUG
  logs:
    lvgl: info
    wifi: DEBUG
    api: DEBUG
    i2c: info
  hardware_uart: UART0

web_server:
  port: 80
  version: 3
  local: true
  log: false
  include_internal: True

psram:
  speed: 200MHz

esp_ldo:
  - channel: 3
    voltage: 2.5V

wifi:
  power_save_mode: NONE
#  fast_connect: True
  post_connect_roaming: False
  networks:
    - ssid: !secret wifi_ssid
      password: !secret wifi_password
      hidden: true

api:
  encryption:
    key: !secret api_encryption_key
  reboot_timeout: 0s
  on_client_connected:
    - delay: 2s
    # Restore backlight to normal after boot tasks complete
    - light.turn_on:
        id: backlight_light
        brightness: 20%
    - script.execute: refresh_main_page

ota:
  - platform: esphome

script:
  - id: refresh_main_page
    then:
      - logger.log: "Main page loaded - Auto-update active"

  - id: refresh_nina2_page
    then:
      - logger.log: "NINA2 page loaded - Auto-update active"

  - id: refresh_nina3_page
    then:
      - logger.log: "NINA3 page loaded - Auto-update active"

  - id: refresh_plants_page
    then:
      - logger.log: "Plants page loaded - Auto-update active"